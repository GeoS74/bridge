<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="stylesheet" href="./css/style_brends.css">
    <title>Бренды</title>
    
  </head>
  <body>

    <div>
      <button onclick="window.location.href = 'http://localhost:3100/';">На главную</button>
    </div>
    <h1>Бренды</h1>
    
    <div>      
      <div style="display: flex;">
        <div class="add">
          <!-- открывает закрывает форму (добаввить бренд)-->
          <input type="submit" id="add" value="добавить бренд" onclick="addVisibilityFun('addForm')"/>
        </div>
        <div class="search">
          <!-- открывает закрывает форму (Поиск бренд)-->
          <input type="submit" id="search" value="поиск бренда" onclick="addVisibilityFun('searchForm')"/>
        </div> 
      </div>
      <script>
        "use strict"
        function addVisibilityFun(id) {
          let elemAdd= document.getElementById('addForm');
          let elemSearch = document.getElementById('searchForm');
          let stateAdd = elemAdd.style.display;
          let stateSearch = elemSearch.style.display;
          if (id === 'addForm') {
            if (stateAdd === "") {
              elemAdd.style.display = "none";
              addForm.reset();
              addForm.dataset.action = '';
  
            } else {
                elemSearch.style.display = "none";
                elemAdd.style.display = "";
                addForm.reset();
                addForm.dataset.action = 'added';
          }
          } else {
              if (stateSearch === "") {
                elemSearch.style.display = "none";
                searchForm.reset();
                searchForm.dataset.action = '';
    
              } else {
                elemAdd.style.display = "none";
                elemSearch.style.display = "";
                searchForm.reset();
                searchForm.dataset.action = 'added';
          }}
        }
  
      </script>
    
        <form style="display: none;" id="addForm" data-action="">
          <input type="text" id="inputAddForm" name="title" placeholder="Добавить бренд"/>
          <input type="submit" value="send" />
        </form>

        <form style="display: none;" id="searchForm" data-action="">
          <input type="text" id="inputsearchForm" name="title" placeholder="Поиск бренда"/>
          <input type="submit" value="send" />
        </form>
    
        <!-- отправляет запрос на добавление -->
        <script>
          "use strict"
          document.querySelector('#addForm')
          .addEventListener('submit', event => {
            event.preventDefault();
    
            const optionalAdd = {
              headers: {},
              method: 'POST',
              body: new FormData(event.target),
            };
            fetch('http://localhost:3100/api/brands', optionalAdd)
            .then(async res => {
              const result = await res.json();
              console.log(result)
            })
            location.reload();
          })       
    
        // отправляет запрос на поиск        
          document.querySelector('#searchForm')
          .addEventListener('submit', event => {
            let adc = document.querySelector('#inputsearchForm').value;         
            event.preventDefault();
            
    
            fetch('http://localhost:3100/api/brands')
              .then(async res => {              
              const result = await res.json();
              console.log(result);
              // addBrand(result);
            })
            // location.reload();
          })
        </script>
    <!-- отрисовывает поиск -->
    <ul id="listSearch" style="display: none;">
    </ul>
    
    <!-- отрисовывает таблицу -->
    <ul id="list" style="display: block;">
    </ul>
    <script>
      "use strict"

      let constForm = 0

      

      fetch('/api/brands')
        .then(async response => {
          if (response.ok) {
            const brands = await response.json();
            brands.map(brand => addBrand(brand))
          }
          else {
            throw new Error(`query status ${response.status}`)
          }
        })
        .catch(error => console.log(error));
       
      function addBrand(brand) {
        // console.log(brand);
        let div = document.createElement('div');
        let buttonDel = document.createElement('button');
        let buttonChenge = document.createElement('button');
        let imgDel = document.createElement('img');
        imgDel.src = "./img/dustbin.svg";
        imgDel.className = 'imgDel'
        buttonDel.append(imgDel);

        let imgChenge = document.createElement('img');
        imgChenge.src = "./img/pencil.svg";
        imgChenge.className = 'imgChenge'
        buttonChenge.append(imgChenge);

        // Удаление бренда
        buttonDel.addEventListener('click', event => {
          if (confirm(`вы собираетесь удалить бренд!!! ${brand.title}`) === true) {
            fetch(`http://localhost:3100/api/brands/${brand.id}`, {
              headers: {},
              method: 'DELETE',
              body: {},
            })
            // location.reload()
          }})

        // Изменение бренда
        buttonChenge.addEventListener('click', event => {
          let inputChenge = prompt(`вы собираетесь Изменить бренд!!! ${brand.title}`)
          const optionalChenge = {
            headers: {
            'Content-Type': 'application/json',
            },
            method: 'PATCH',
            body: JSON.stringify({ title: inputChenge }),
            };
          fetch(`http://localhost:3100/api/brands/${brand.id}`, optionalChenge)
          .catch(error => console.log(error))
          location.reload()
          })

        div.className = `li-${brand.id}`;
        div.insertAdjacentHTML('afterbegin', `<li data-id="${brand.id}">${brand.title}</li>`);
        div.prepend(buttonChenge);
        div.prepend(buttonDel);
        list.append(div);
        
      }
    </script>
    
  </body>
</html>