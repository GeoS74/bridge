<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <title>Brands</title>
    <link rel="stylesheet" href="./css/style_brands.css" />
  </head>
  <body>
    <h1>Бренды</h1>
    <div style="display: flex;">
      <div class="add">
        <!-- открывает закрывает форму (добаввить бренд)-->
        <input type="submit" id="add" value="добавить бренд" onclick="addVisibilityFun('addForm')"/>
        <script>
          "use strict"
          function addVisibilityFun(id) {
            let elem = document.getElementById(id);
            let state = elem.style.display;
            if (state === "") {
              elem.style.display = "none";
              addForm.reset();
              addForm.dataset.action = '';
    
            } else {
              elem.style.display = "";
              addForm.reset();
              addForm.dataset.action = 'added';
            }
          }
    
        </script>
    
        <form style="display: none;" id="addForm" data-action="">
          <input type="text" id="inputAddForm" name="title" value="add"/>
          <input type="submit" value="send" />
        </form>
    
        <!-- отправляет запрос на добавление -->
        <script>
          "use strict"
          document.querySelector('#addForm')
          .addEventListener('submit', event => {
            event.preventDefault();
    
            const optionalAdd = {
              headers: {},
              method: 'POST',
              body: new FormData(event.target),
            };
            fetch('http://localhost:3100/api/brands', optionalAdd)
            .then(async res => {
              const result = await res.json();
              console.log(result)
            })
            location.reload();
          })
        </script>
      </div>   
    
    </div>

    
    <!-- отрисовывает таблицу -->
    <ul id="list">
      <li>
        <button>
          <img src="./css/style_brands.css" alt="">
        </button>
      </li>
    </ul>
    <script>
      "use strict"

      fetch('/api/brands')
        .then(async response => {
          if (response.ok) {
            const brands = await response.json();
            brands.map(brand => addBrand(brand))
          }
          else {
            throw new Error(`query status ${response.status}`)
          }
        })
        .catch(error => console.log(error));

      function addBrand(brand) {
        let div = document.createElement('div');
        let button = document.createElement('button');
        let imgDel = document.createElement('img');
        imgDel.src = "./img/dustbin.svg";
        imgDel.className = 'imgDel'
        button.append(imgDel);
        button.addEventListener('click', event => {
          if (confirm(`вы собираетесь удалить бренд!!! ${brand.title}`) === true) {
            fetch(`http://localhost:3100/api/brands/${brand.id}`, {
              headers: {},
              method: 'DELETE',
              body: {},
            })
            location.reload()
          }})

        div.className = `li-${brand.id}`;
        div.style.display = "flex";
        div.insertAdjacentHTML('afterbegin', `<li data-id="${brand.id}">${brand.title}</li>`);
        div.prepend(button);
        list.append(div);
        
      }

      // list.addEventListener('click', event => {
      //   let elemDel = document.getElementById('inputDelForm')
      //   elemDel.value = event.target.dataset.id;
      //   if (!event.target.closest('li')) return;
      //   console.log(event.target.dataset.id)
        
      //   addForm.hidden = false;
      //   addForm.reset();
      //   addForm.dataset.action = 'updated'
      // })
    </script>
    
  </body>
</html>