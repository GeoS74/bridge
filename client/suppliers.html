<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="stylesheet" href="./css/style_suppliers.css">
    <title>Поставщики</title>
    
  </head>
  <body>
    <div>
      <button onclick="window.location.href = 'http://localhost:3100/';">На главную</button>
    </div>
    <h1>Поставщики</h1>
    
    <div style="display: flex;">
      <div class="add">
        <!-- открывает закрывает форму (добаввить бренд)-->
        <input type="submit" id="add" value="добавить поставщика" onclick="addVisibilityFun('addForm')"/>
        <script>
          "use strict"
          function addVisibilityFun(id) {
            let elem = document.getElementById(id);
            let state = elem.style.display;
            if (state === "") {
              elem.style.display = "none";
              addForm.reset();
              addForm.dataset.action = '';
    
            } else {
              elem.style.display = "";
              addForm.reset();
              addForm.dataset.action = 'added';
            }
          }
    
        </script>
    
        <form style="display: none;" id="addForm" data-action="">
          <input type="text" id="inputAddForm" name="title"/>
          <input type="submit" value="send" />
        </form>
    
        <!-- отправляет запрос на добавление -->
        <script>
          "use strict"
          document.querySelector('#addForm')
          .addEventListener('submit', event => {
            event.preventDefault();
    
            const optionalAdd = {
              headers: {},
              method: 'POST',
              body: new FormData(event.target),
            };
            fetch('http://localhost:3100/api/brands', optionalAdd)
            .then(async res => {
              const result = await res.json();
              console.log(result)
            })
            location.reload();
          })
        </script>
      </div>   
    
    </div>

    
    <!-- отрисовывает таблицу -->
    <ul id="list">
    </ul>
    <script>
      "use strict"

      fetch('/api/brands')
        .then(async response => {
          if (response.ok) {
            const brands = await response.json();
            brands.map(brand => addBrand(brand))
          }
          else {
            throw new Error(`query status ${response.status}`)
          }
        })
        .catch(error => console.log(error));
       
      function addBrand(brand) {
        let div = document.createElement('div');
        let buttonDel = document.createElement('button');
        // buttonDel.append('DEL')
        let buttonChenge = document.createElement('button');
        // buttonChenge.append('Chenge')        
        let imgDel = document.createElement('img');
        imgDel.src = "./img/dustbin.svg";
        imgDel.className = 'imgDel'
        buttonDel.append(imgDel);

        let imgChenge = document.createElement('img');
        imgChenge.src = "./img/pencil.svg";
        imgChenge.className = 'imgChenge'
        buttonChenge.append(imgChenge);

        // Удаление бренда
        buttonDel.addEventListener('click', event => {
          if (confirm(`вы собираетесь удалить бренд!!! ${brand.title}`) === true) {
            fetch(`http://localhost:3100/api/brands/${brand.id}`, {
              headers: {},
              method: 'DELETE',
              body: {},
            })
            location.reload()
          }})

        // Изменение бренда
        buttonChenge.addEventListener('click', event => {
          let inputChenge = prompt(`вы собираетесь Изменить бренд!!! ${brand.title}`)
          const optionalChenge = {
            headers: {
            'Content-Type': 'application/json',
            },
            method: 'PATCH',
            body: JSON.stringify({ title: inputChenge }),
            };
          fetch(`http://localhost:3100/api/brands/${brand.id}`, optionalChenge)
          .catch(error => console.log(error))
          location.reload()
          })

        div.className = `li-${brand.id}`;
        // div.style.display = "flex";
        // div.style.alignItems = "center";
        div.insertAdjacentHTML('afterbegin', `<li data-id="${brand.id}">${brand.title}</li>`);
        div.prepend(buttonChenge);
        div.prepend(buttonDel);
        list.append(div);
        
      }
    </script>
    
  </body>
</html>