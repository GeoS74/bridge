# Обработка номенклатуры 1С

Номенклатура 1C может быть загружена в базу данных [[API для загрузки данных из 1С|напрямую из 1С]] или из файла Excel. Основной момент, на который стоит обратить внимание - это то, что данные, сформированные 1С имеют уникальный идентификатор каждой позиции, плюс информацию по остаткам в разрезе складов. Поэтому, при выборе варианта загрузки данных из файла Excel надо это учитывать, т.к. скорее всего будет затруднительно или невозможно передать через Excel правильные идентификаторы и структуру остатков по складам.

### Описание процесса обработки номенклатуры

Предполагается, что каждая единица номенклатуры 1С имеет свой уникальный идентификатор и уникальный код ([[Схема базы данных|cм. таблицу "bovid" в схеме БД]]). Эти значения должны быть уникальными и не могут отсутстввать. Загрузка номенклатуры использует это допущения при сопоставления новых карточек. В общем случае правила загрузки выглядят так:
1. Если получено значение уникального идентификатора позиции, то будет выполнена попытка поиска существующей позиции с таким идентификатором. Если такой позиции нет, то позиция будет записана, если есть - то данные будут обновлены.
2. Если значение уникального идентификатора позиции отсутствует, то будет выполнена попытка поиска существующей позиции по коду позиции. Если такой позиции нет, то позиция будет записана, если есть - то данные будут обновлены.

>**ВАЖНО** Позиции, которые не имеют артикула игнорируются. Это же касается позиций у которых в артикуле нет ни одной буквы или цифры. Такие позиции не записываются и не обновляются в БД. Таким образом, если ранее была записана позиция, имевшая артикул, а затем будет получена она же (такой же идентификатор или код) - то данные перезаписаны не будут.

### Обновление данных

При обновлении данных перезаписываются следующие поля [[Таблица номенклатуры 1С|таблицы "bovid"]]:
- updatedat (устанавливается текущая временная метка);
- article;
- article_parse (значение вычисляется на основе article);
- title;
- amount (вычисляется на основе данных storage),
- storage;
- weight;
- width;
- height;
- length;
- manufacturer.

[[main|На главную]]