# API для загрузки данных из 1С

Маршрут:
```
POST /api/ut/upload
```

## Структура данных

**ВНИМАНИЕ** Так исторически сложилось, что данные, формируемые и передаваемые 1С имеют несколько неожиданную структуру, а именно:

```
{
  json_data: "JSON кодированная строка"
}
```
Т.е. получается, как бы json  в json-e. Сейчас это исправить не представляется возможным, т.к. поломается много рабочего кода.

Пример структуры данных, доступных по ключу `json_data`:

```
[
  {
    "id": "ec7e7c06-df4c-4f35-aea8-c3712fe3420c",
    "code": "261995",
    "article": "П50.11.2905006-30",
    "name": "Амортизатор (ход 445*695) КАМАЗ-5308, 53082, 540, 5460 (замена на П50.11.2905005-30) (ПААЗ) 50.11.2905006-30",
    "price": "2790.00",
    "weight": "45.85",
    "length": "12",
    "width": "5.3",
    "height": "55",
    "manufacturer": "КАМАЗ",
    "storage": [
      {
        "amount": "3"
      },
      {
        "amount": "2"
      }
    ]
  },
]
```
В этом примере отображены все ключи, которые обрабатывает сервер при получении данных от 1С. Если передаются какие-то дополнительные ключи, то они будут проигнорированы.

В случае успешной передачи данных сервер вернёт сатус **200** и дополнительно json структуру с сообщением:

```
{
  message: "upload positions complete"
}
```

Если запрашиваемый возникнут ошибки при разборе данных, сервер ответит статусом **400** или **500** с описанием возникшей [[Описание ошибок|ошибки]].

## Валидация данных сервером

При получении данных сначала сервер проверяет доступность данных по ключу `json_data`, затем декодирует эти данные (по ключу `json_data` 1С передаёт данные сериализованные в json, см. описание этого выше) и проверит, что полученная структура является массивом.
Если возникнет какая-либо ошибка, то сервер ответит статусом **400** с описанием возникшей [[Описание ошибок|ошибки]].

Далее, при обработке данные, сервер также будет проверять некоторые данные (например, уникальность идентификатора позиции), но в случае возникновения таких ошибок сервер не будет о них сообщать клиенту. Все ошибки, возникающие при записи в базу данных, логируются сервером и не возвращаются. [[Обработка номенклатуры 1С|Читать подробнее про обработку и запись позиций из 1С]].

[[main|На главную]]
